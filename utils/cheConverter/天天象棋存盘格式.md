天天象棋存盘格式说明

=====

# 声明
由于本人未看到官方的格式说明文档，所以以下资料在使用时，可能有错误的风险。另外，本格式仅在2017年的收藏棋谱的格式上得到验证。不保证今后的存盘格式不发生变化。

# 格式说明
对于收藏的棋谱，在手机上，.QQChess/ok目录下，有如下文件目录：
文件为：fupanSaveInfo_new
目录为：savefupan_new

## 棋局文件目录 savefupan_new 摘要
这个目录下，是天天象棋收藏棋谱的文件。这些文件没有后缀名，文件名称象是一个GUID值。文件内容是文本格式，全是数字。

## 棋谱摘要信息文件 fupanSaveInfo_new
fupanSaveInfo_new是一个XML格式的文本文件，用于记录各存储棋局的存盘文件，以及对弈者等信息。
示例如下：
```
<key>2017-12-11_07-29-09_(1307285328_1)_qqxqEX.che</key>
<dict>
    <key>TIME</key>
    <string>1512948549</string>
    <key>OTHER_LV</key>
    <string>10260</string>
    <key>MY_PLATFORM</key>
    <string>1</string>
    <key>MY_NAME</key>
    <string>文字太轻回忆太重</string>
    <key>TITLE</key>
    <string>【旁观】棋力评测</string>
    <key>MY_LV</key>
    <string>5950</string>
    <key>CHESS_COLOR</key>
    <string>0</string>
    <key>ISSINGLE</key>
    <string>0</string>
    <key>OTHER_HEAD</key>
    <string>9f6abd23fcc942ba472827c0e948ea9f</string>
    <key>OTHER_NAME</key>
    <string>再战</string>
    <key>MY_HEAD</key>
    <string>7ea31f015bba2096e9206f4a58468958</string>
    <key>RESULT_STATE</key>
    <string>2</string>
    <key>MY_UIN</key>
    <string>1307285328</string>
    <key>STEPCONUT</key>
    <string>108</string>
</dict>
```
最外面的key值 ：<key>2017-12-11_07-29-09_(1307285328_1)_qqxqEX.che</key>
就是实际存盘文件的名字：2017-12-11_07-29-09_(1307285328_1)_qqxqEX.che
当然，这个文件不一定有后缀名，有时，文件名就是一个GUID值。

在dict段中，一组key和string，是一个属性。如红方的级别：
<key>MY_LV</key>
<string>5950</string>

这个5950是等级分，根据天天的规则，这个是业9-3。

<key>MY_NAME</key>对应的是红方玩家的名称，<key>OTHER_NAME</key>对应的是黑方。


## 棋局文件目录 savefupan_new 下的文件详细说明
文件内容是文本格式，都是数字，示例如下：
```
0 17 -1 32 1 12 3 11 3 0 1 0 11 32 1 5 4 12 4 0 2 0 -1 32 1 12 11 11 11 0 3 0 11 32 1 5 10 12 10 0 4 0 -1 32 1 10 4 10 7 0 5 0 -1 32 1 3 4 5 5 0 6 0 -1 32 1 11 11 11 4 0 7 0 -1 32 1 3 3 3 4 0 8 0 20 32 1 11 4 3 4 0 9 0 12 32 1 5 5 3 4 0 10 0 22 32 1 10 7 6 7 0 11 0 -1 32 1 3 10 5 9 0 12 0 -1 32 1 6 7 7 7 0 13 0 -1 32 1 3 4 5 5 0 14 0 -1 32 1 10 10 8 10 0 15 0 -1 32 1 3 11 3 10 0 16 0 -1 32 1 8 10 8 7 0 17 0

```

翻译如下：
```
0 17 -1   计17步
32 1 12 3 11 3 0 1 0 11   车一进一
32 1 5 4 12 4 0 2 0 -1    炮8进7
32 1 12 11 11 11 0 3 0 11 车九进一
32 1 5 10 12 10 0 4 0 -1  炮2进7
32 1 10 4 10 7 0 5 0 -1   炮二平五
32 1 3 4 5 5 0 6 0 -1     马8进7
32 1 11 11 11 4 0 7 0 -1  车九平二
32 1 3 3 3 4 0 8 0 20     车9平8
32 1 11 4 3 4 0 9 0 12    车二进八
32 1 5 5 3 4 0 10 0 22     马8退7
32 1 10 7 6 7 0 11 0 -1    炮五进四
32 1 3 10 5 9 0 12 0 -1    马2进3
32 1 6 7 7 7 0 13 0 -1    炮五退一
32 1 3 4 5 5 0 14 0 -1    马8进7
32 1 10 10 8 10 0 15 0 -1  炮八进二
32 1 3 11 3 10 0 16 0 -1   车1平2
32 1 8 10 8 7 0 17 0  炮二平五（计17步，红胜）
```


## 格式说明
前3个数字为开头，其中，第2个表示总的步数。
然后是每10个数字为一步，当然，最后如果黑方未走，就不满10步。有时，10个数字不能填满时，结尾使用-1占位。


在每组10个数字中，前2个数字不用管，目前看来，都是：32 1。
后面4个数字，是位置的变化。这个格式和以前的.che是有变化的。以前是有棋子类型的，目前没有。这个和东萍的存储格式有类似之处。只不过，坐标习惯不同。
最后4个数字，第2个数字为当前的步数。

对于将目前的.che格式（当然，文件可能没有后缀名）转换为东萍格式的需求，知道上述信息，基本就够了。
目前缺的，就是坐标的规律。

### 坐标
天天中，坐标为从下左到上右，下左角为(1,1)，左下角为 ( 9   , 10)

这个好像是评测中的存储，对于个人对局，即与电脑对局，好像还是另一个存储习惯。


东萍中，坐标为左上到右下，(0,0) -> (8,9)

举例如下：
天天         翻译          东萍
3 8 3 5  -> 炮二平五    -> 7 7 4 7

所以，转换起来，还是很容易的。


# 参考
http://blog.csdn.net/jcwkyl/article/details/2223585


前两数字，以及末两数字，为总的步数


如  0 17 … 17 0  表示9回合

     0  19 … 19 0 表示10回合






这个格式没发现大的规律



-1 32 1 8 10 8 7 0

-1 32 1 8  9  8 7 0  


 前者可能表示炮八平五，第二行表示炮七平五




这里有个分析帖：

http://blog.csdn.net/jcwkyl/article/details/2223585


用qq游戏大厅里带的那个象棋游戏看起来很不爽，而且它导出的棋谱是左右颠倒的。以下是用记事本打开qq象棋棋谱文件经过一番观察后得出的结论：

下面是一份完整的che格式的文件：

1 62 21 32 1 0 1 2 2 0 1 0 10 32 0 7 7 7 4 0 2 0 26 32 1 2 7 2 5 0 3 0 6 32 0 9 7 7 6 0 4 0 17 32 1 0 3 1 4 0 5 0 1 32 0 9 3 8 4 0 6 0 30 32 1 3 6 4 6 0 7 0 8 32 0 9 8 9 7 0 8 0 22 32 1 0 7 2 6 0 9 0 5 32 0 9 1 7 2 0 10 0 22 32 1 2 6 4 5 0 11 0 13 32 0 6 4 5 4 0 12 0 28 32 1 3 2 4 2 0 13 0 9 32 0 7 1 7 0 0 14 0 25 32 1 2 1 6 1 0 15 0 8 32 0 9 7 5 7 0 16 0 22 32 1 4 5 5 3 0 17 0 5 32 0 7 2 6 4 0 18 0 25 32 1 6 1 6 4 0 19 0 6 32 0 7 6 6 4 0 20 0 22 32 1 5 3 7 4 0 21 0 3 32 0 9 2 7 4 0 22 0 23 32 1 0 0 0 1 0 23 0 14 32 0 6 6 5 6 0 24 0 21 32 1 2 2 4 3 0 25 0 6 32 0 6 4 7 6 0 26 0 30 32 1 4 6 5 6 0 27 0 8 32 0 5 7 5 6 0 28 0 19 32 1 0 2 2 4 0 29 0 9 32 0 7 0 3 0 0 30 0 21 32 1 4 3 6 2 0 31 0 9 32 0 3 0 3 2 0 32 0 21 32 1 6 2 4 3 0 33 0 7 32 0 9 0 9 3 0 34 0 23 32 1 0 1 0 3 0 35 0 8 32 0 5 6 3 6 0 36 0 24 32 1 0 8 0 7 0 37 0 8 32 0 3 6 3 4 0 38 0 24 32 1 0 7 7 7 0 39 0 8 32 0 3 4 3 6 0 40 0 26 32 1 2 5 4 5 0 41 0 13 32 0 5 4 4 4 0 42 0 26 32 1 4 5 4 6 0 43 0 13 32 0 4 4 4 3 0 44 0 24 32 1 7 7 7 6 0 45 0 8 32 0 3 6 3 5 0 46 0 28 32 1 4 2 5 2 0 47 0 9 32 0 3 2 3 4 0 48 0 28 32 1 5 2 6 2 0 49 0 13 32 0 4 3 3 3 0 50 0 26 32 1 4 6 4 4 0 51 0 13 32 0 3 3 2 3 0 52 0 23 32 1 0 3 0 1 0 53 0 8 32 0 3 5 4 5 0 54 0 23 32 1 0 1 4 1 0 55 0 13 32 0 2 3 1 3 0 56 0 26 32 1 4 4 4 3 0 57 0 8 32 0 4 5 4 3 0 58 0 23 32 1 4 1 4 3 0 59 0 7 32 0 9 3 4 3 0 60 0 17 32 1 1 4 2 3 0 61 0 9 32 0 3 4 0 4 0 62 0

把这些数据保存到文本文件中再把后缀名改为che就可以用qq象棋程序打开。

其中第一个1无意义，第二个数字62表示棋谱总共有多少步数。接下来可以发现32出现多次，而且间隔一都是10。所以从文件的第三个数字21开始每10个数字一组分组，然后和记录下来的棋谱相比，有以下规律：

21 32 1 0 1 2 2 0 1 0

10 32 0 7 7 7 4 0 2 0

这是前两组。每组的第一个数表示是哪个棋子，如21表示马，10表示炮。经过与记录下的棋谱对比后发现：

若是黑方走子，则：

0（将）；1，2（士）；3，4（象）；5，6（马）；7，8（车）；9，10（炮）；

11，12，13，14，15（卒）。

若是红方走子，则：

16（帅）；17，18（士）；19，20（相）；21，22（马）；23，24（车）；25，26（炮）；

27，28，29，30，21（兵）。

每组的第二个数字不变，总为32。

每组第三个数字表示此步走子为红方还是黑方，1代表红方，0代表黑方。

每组第四，五，六，七个数字表示源位置和目标位置的坐标。

每组第八个数字总是0。

每组第九个数字表示是棋谱中的第几步走子。

第十个数字也总是为0。




第10个数字一分组，确实符合上一版的.che格式，即以前保存的格式。

今天(2017.08.20)保存的格式，也完全符合。-1是占位数字，用于凑满10个数字。


当然，最后一步如红绝杀，则黑无应招，此时不满10个数字。


那现有的谱中,这个第一步为：

32 1 12 3 11 3 0 1 0 11

32 1的1表示红走； 12 3 11 3 表示车一进一


32 1 12 3 11 3 0 1 0 11

32 1 5 4 12 4 0 2 0 -1


第二个32表示炮8进7


其中12 3 11 3，以及5 4 12 4应该表示位置


因为12与11表示红进1，5与12表示黑进7



坐标为从右上到左下，右上角为(3,3)，左下角为 ( 11   , 12)


按10条线算，纵坐标应该减2 (从上到下，为   13 11 … 3)

横坐标更奇葩，从右手算，车一对应的数字是3，也是减2，倒是有点规律。


表示位置变化的4个数字之后的3个数字，目前看到，中间的步数，两边都是0。

如0 1 0, 0 2 0, 0 3 0, ...


第10个数字有11，有-1，有20，12，22，目前不知道是什么，可能是校验码？


总之，这个倒是可以解析了。




目前的问题，就是如何得到微信分享的应用的数据？



2017-08-20_07-31-46_(12159312_0)_qqxqEX.che

2017-08-20_07-32-39_(12159312_0)_qqxqEX.che

2017-08-20_07-33-20_(12159312_0)_qqxqEX.che


下面附3局（天天人机实战局）：


0 17 -1 32 1 12 3 11 3 0 1 0 11 32 1 5 4 12 4 0 2 0 -1 32 1 12 11 11 11 0 3 0 11 32 1 5 10 12 10 0 4 0 -1 32 1 10 4 10 7 0 5 0 -1 32 1 3 4 5 5 0 6 0 -1 32 1 11 11 11 4 0 7 0 -1 32 1 3 3 3 4 0 8 0 20 32 1 11 4 3 4 0 9 0 12 32 1 5 5 3 4 0 10 0 22 32 1 10 7 6 7 0 11 0 -1 32 1 3 10 5 9 0 12 0 -1 32 1 6 7 7 7 0 13 0 -1 32 1 3 4 5 5 0 14 0 -1 32 1 10 10 8 10 0 15 0 -1 32 1 3 11 3 10 0 16 0 -1 32 1 8 10 8 7 0 17 0




0 17 -1 32 1 12 3 11 3 0 1 0 11 32 1 5 4 12 4 0 2 0 -1 32 1 12 11 11 11 0 3 0 11 32 1 5 10 12 10 0 4 0 -1 32 1 10 4 10 7 0 5 0 -1 32 1 3 4 5 5 0 6 0 -1 32 1 11 11 11 4 0 7 0 -1 32 1 3 3 3 4 0 8 0 20 32 1 11 4 3 4 0 9 0 12 32 1 5 5 3 4 0 10 0 22 32 1 10 7 6 7 0 11 0 -1 32 1 3 4 5 5 0 12 0 -1 32 1 6 7 7 7 0 13 0 -1 32 1 3 10 5 11 0 14 0 -1 32 1 10 10 8 10 0 15 0 -1 32 1 3 11 3 10 0 16 0 -1 32 1 8 10 8 7 0 17 0




0 19 -1 32 1 12 3 11 3 0 1 0 11 32 1 5 4 12 4 0 2 0 -1 32 1 12 11 11 11 0 3 0 11 32 1 5 10 12 10 0 4 0 -1 32 1 10 4 10 7 0 5 0 -1 32 1 3 4 5 5 0 6 0 -1 32 1 11 11 11 4 0 7 0 -1 32 1 3 3 3 4 0 8 0 20 32 1 11 4 3 4 0 9 0 12 32 1 5 5 3 4 0 10 0 22 32 1 10 7 6 7 0 11 0 -1 32 1 3 4 5 5 0 12 0 -1 32 1 6 7 7 7 0 13 0 -1 32 1 3 10 5 11 0 14 0 -1 32 1 10 10 8 10 0 15 0 -1 32 1 3 11 4 11 0 16 0 -1 32 1 8 10 8 9 0 17 0 -1 32 1 5 11 4 9 0 18 0 -1 32 1 8 9 8 7 0 19 0



其中，第一局对应的棋谱如下：


0 17 -1

32 1 12 3 11 3 0 1 0 11   车一进一

32 1 5 4 12 4 0 2 0 -1    炮8进7

32 1 12 11 11 11 0 3 0 11 车九进一

32 1 5 10 12 10 0 4 0 -1  炮2进7

32 1 10 4 10 7 0 5 0 -1   炮二平五

32 1 3 4 5 5 0 6 0 -1     马8进7

32 1 11 11 11 4 0 7 0 -1  车九平二

32 1 3 3 3 4 0 8 0 20     车9平8

32 1 11 4 3 4 0 9 0 12    车二进八

32 1 5 5 3 4 0 10 0 22     马8退7

32 1 10 7 6 7 0 11 0 -1    炮五进四

32 1 3 10 5 9 0 12 0 -1    马2进3

32 1 6 7 7 7 0 13 0 -1    炮五退一

32 1 3 4 5 5 0 14 0 -1    马8进7

32 1 10 10 8 10 0 15 0 -1  炮八进二

32 1 3 11 3 10 0 16 0 -1   车1平2

32 1 8 10 8 7 0 17 0  炮二平五（计17手，红胜）













  // 天天中，坐标为从下左到上右，下左角为(1,1)，左下角为 ( 9   , 10)

  // 这个好像是评测中的存储，对于个人对局，即与电脑对局，还有另一个存储。


  // 东萍中，坐标为左上到右下，(0,0) -> (8,9)

  //   // 3 8 3 5  -> 炮二平五    -> 7 7 4 7



 上面是评测，下面是与电脑：

  // 天天中，坐标为从右上到左下，右上角为(3,3)，左下角为 ( 11   , 12)
